// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  JOB_SEEKER
  EMPLOYER
  ADMIN
}

enum JobStatus {
  ACTIVE
  INACTIVE
  PENDING
}

enum ApplicationStatus {
  PENDING
  REVIEWED
  SHORTLISTED
  REJECTED
}

enum SubscriptionPlanType {
  TRIAL
  BASIC
  PREMIUM
}

enum SubscriptionStatus {
  ACTIVE
  EXPIRED
  CANCELLED
}

enum EmploymentType {
  FULL_TIME
  PART_TIME
  CONTRACT
  INTERNSHIP
  FREELANCE
}

model User {
  id                    String    @id @default(cuid())
  email                 String    @unique
  password              String
  role                  UserRole  @default(JOB_SEEKER)
  emailVerified         Boolean   @default(false)
  emailVerificationToken String?  @unique
  emailVerificationTokenExpiry DateTime?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  // Relations
  jobSeekerProfile JobSeekerProfile?
  employerProfile  EmployerProfile?

  @@index([email])
  @@index([role])
  @@index([emailVerificationToken])
}

model JobSeekerProfile {
  id                String   @id @default(cuid())
  userId            String   @unique
  firstName         String
  lastName          String
  phone             String?
  location          String?
  resumeUrl         String?
  skills            String[] @default([])
  experience        Int?     @default(0) // years of experience
  education         String?
  jobTitle          String?
  bio               String?  @db.Text
  availabilityStatus String? @default("AVAILABLE") // AVAILABLE, UNAVAILABLE, LOOKING
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  applications Application[]
  savedCandidates SavedCandidate[]

  @@index([userId])
  @@index([skills])
  @@index([location])
}

model EmployerProfile {
  id                  String   @id @default(cuid())
  userId              String   @unique
  companyName         String
  companyLogo         String?
  industry            String?
  companySize         String?
  website             String?
  description         String?  @db.Text
  subscriptionId      String?
  subscriptionStatus  SubscriptionStatus? @default(EXPIRED)
  subscriptionExpiry  DateTime?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  user            User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  jobs            Job[]            @relation("JobPostedBy")
  subscriptions   Subscription[]
  savedCandidates SavedCandidate[]

  @@index([userId])
  @@index([companyName])
}

model Job {
  id                String         @id @default(cuid())
  title             String
  description       String         @db.Text
  category          String
  location          String
  experienceRequired Int?          @default(0) // years
  salaryRange       String?        // e.g., "50000-80000"
  employmentType    EmploymentType @default(FULL_TIME)
  status            JobStatus      @default(PENDING)
  postedBy          String
  expiresAt         DateTime?
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt

  employer EmployerProfile @relation("JobPostedBy", fields: [postedBy], references: [userId], onDelete: Cascade)
  applications Application[]

  @@index([postedBy])
  @@index([status])
  @@index([category])
  @@index([location])
  @@index([createdAt])
}

model Application {
  id            String            @id @default(cuid())
  jobId         String
  jobSeekerId   String
  status        ApplicationStatus @default(PENDING)
  coverLetter   String?           @db.Text
  appliedAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt

  job       Job            @relation(fields: [jobId], references: [id], onDelete: Cascade)
  jobSeeker JobSeekerProfile @relation(fields: [jobSeekerId], references: [userId], onDelete: Cascade)

  @@unique([jobId, jobSeekerId])
  @@index([jobId])
  @@index([jobSeekerId])
  @@index([status])
  @@index([appliedAt])
}

model Subscription {
  id                  String              @id @default(cuid())
  employerId          String
  planType            SubscriptionPlanType @default(TRIAL)
  status              SubscriptionStatus  @default(ACTIVE)
  startDate           DateTime            @default(now())
  endDate             DateTime
  razorpayOrderId     String?
  razorpayPaymentId   String?
  razorpaySignature   String?
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt

  employer EmployerProfile @relation(fields: [employerId], references: [userId], onDelete: Cascade)

  @@index([employerId])
  @@index([status])
  @@index([endDate])
}

model SavedCandidate {
  id          String   @id @default(cuid())
  employerId String
  jobSeekerId String
  savedAt    DateTime @default(now())

  employer  EmployerProfile @relation(fields: [employerId], references: [userId], onDelete: Cascade)
  jobSeeker JobSeekerProfile @relation(fields: [jobSeekerId], references: [userId], onDelete: Cascade)

  @@unique([employerId, jobSeekerId])
  @@index([employerId])
  @@index([jobSeekerId])
}

